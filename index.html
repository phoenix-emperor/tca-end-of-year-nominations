<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Employee Nominations 2025</title>
  <style>
    body {
      font-Family: Arial, sans-serif;
      text-align: center;
      background: #f0f8ff;
      padding: 20px;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
    }

    h1 {
      color: #2c3e50;
    }

    .category-btn {
      display: block;
      width: 90%;
      margin: 12px auto;
      padding: 18px;
      font-size: 18px;
      background: #3498db;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }

    .category-btn:hover {
      background: #2980b9;
    }

    #nomination-form {
      display: none;
      margin: 30px auto;
      padding: 25px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      max-width: 500px;
    }

    input {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      font-size: 16px;
    }

    #submit-btn {
      padding: 12px 30px;
      background: #27ae60;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>Employee Awards 2025</h1>
    <p>Click a category to nominate someone</p>

    <button class="category-btn" data-category="Most Punctual Staff">Most Punctual Staff</button>
    <button class="category-btn" data-category="Team Player of the Year">Team Player of the Year</button>
    <button class="category-btn" data-category="Office Comedian Award">Office Comedian Award</button>
    <button class="category-btn" data-category="Rising Star Award">Rising Star Award</button>
    <button class="category-btn" data-category="Best Dressed Employee">Best Dressed Employee</button>
    <button class="category-btn" data-category="Top Facilitator">Top Facilitator</button>
    <button class="category-btn" data-category="Employee of the Year">Employee of the Year</button>
    <button class="category-btn" data-category="Mr/Ms Dependable">Mr/Ms Dependable</button>

    <div id="nomination-form">
      <h2 id="category-title"></h2>
      <label>Type or select employee name:</label>
      <input list="employees" id="employee-name" placeholder="Start typing..." required>
      <datalist id="employees"></datalist>
      <br><br>
      <button id="submit-btn">Submit Nomination</button>
    </div>
  </div>

  <!-- ALL JAVASCRIPT GOES HERE (no external script.js) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
    import { getFirestore, collection, addDoc, serverTimestamp, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";
    import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";

    // ←←← PASTE YOUR OWN CONFIG HERE ←←←
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
      apiKey: "AIzaSyDnXrnjdNUKa3jil3H7I9XZSPsbvaXbCdM",
      authDomain: "staff-awards-2025.firebaseapp.com",
      projectId: "staff-awards-2025",
      storageBucket: "staff-awards-2025.firebasestorage.app",
      messagingSenderId: "364044970466",
      appId: "1:364044970466:web:602f0f2247b52fd63ff1bb",
      measurementId: "G-BV3LM3XKJY"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    let currentUser = null;
    let currentCategory = "";

    document.addEventListener("DOMContentLoaded", () => {
      // 1. Sign in anonymously
      onAuthStateChanged(auth, user => {
        if (user) currentUser = user;
        else signInAnonymously(auth);
      });

      // 2. Load employee names
      fetch("employees.json")
        .then(r => r.json())
        .then(data => {
          const names = Array.isArray(data) ? data : (data.employees || []);
          const list = document.getElementById("employees");
          names.forEach(n => {
            const opt = document.createElement("option");
            opt.value = n;
            list.appendChild(opt);
          });
        });

      // 3. Button clicks
      document.querySelectorAll(".category-btn").forEach(btn => {
        btn.addEventListener("click", async () => {
          // Wait briefly if auth still loading
          if (!currentUser) {
            await new Promise(r => setTimeout(r, 800));
            if (!currentUser) return alert("Still loading… try again in 2 seconds");
          }

          currentCategory = btn.dataset.category;
          document.getElementById("category-title").textContent = `Nominate for: ${currentCategory}`;

          // Check for duplicate vote
          const q = query(
            collection(db, "nominations"),
            where("userId", "==", currentUser.uid),
            where("category", "==", currentCategory)
          );
          const snap = await getDocs(q);
          if (!snap.empty) {
            alert("You have already voted in this category!");
            return;
          }

          document.getElementById("nomination-form").style.display = "block";
          document.getElementById("employee-name").focus();
        });
      });

      // 4. Submit vote
      document.getElementById("submit-btn").addEventListener("click", async () => {
        const name = document.getElementById("employee-name").value.trim();
        if (!name) return alert("Please select a name");

        try {
          await addDoc(collection(db, "nominations"), {
            category: currentCategory,
            employeeName: name,
            userId: currentUser.uid,
            timestamp: serverTimestamp()
          });
          alert("Thank you! Your vote was recorded.");
          document.getElementById("nomination-form").style.display = "none";
          document.getElementById("employee-name").value = "";
        } catch (e) {
          alert("Error submitting vote. Try again.");
        }
      });
    });
  </script>
</body>

</html>